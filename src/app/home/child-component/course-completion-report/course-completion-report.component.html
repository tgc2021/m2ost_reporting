<div class="login-web">
    <div class="dropdown-container-box d-flex w-100 p-2 justify-content-center gap-3">
        <div class="dropbox">
            <button type="button" class="dropdown-btn custom-dropdown-button fontRoboto" data-bs-toggle="dropdown"
                aria-expanded="false" (click)="getDepartment()">
                <div class="d-flex">
                    <div class="ellipsis">
                        {{ departmentValue }}
                    </div>
                    <div><i class="bi bi-caret-down-fill down-icon"></i></div>
                </div>
            </button>
            <ul class="dropdown-menu dept-menu" id="dept">
                <li class="fontRoboto" (click)="$event.stopPropagation()">
                    <input type="checkbox" class="checkbox" [checked]="isAllDepartmentsSelected()"
                        id="selectAllDepartments" (change)="toggleSelectAllDepartments($event)" />
                    Select All
                </li>
                <li class="fontRoboto" *ngFor="let dept of department; let i = index"
                    (click)="$event.stopPropagation()">
                    <input type="checkbox" class="checkbox" [checked]="isDepartmentSelected(dept)" id="{{'dept-' + i}}"
                        (change)="toggleDepartmentSelection(dept, $event)" />
                    {{ dept.Department_name }}
                </li>
            </ul>
        </div>
        <div class="dropbox">
            <button type="button" class="dropdown-btn custom-dropdown-button fontRoboto" data-bs-toggle="dropdown"
                [disabled]="departmentValue =='Select Department'" aria-expanded="false" (click)="getRoles()">
                <div class="d-flex">
                    <div class="ellipsis">
                        {{ roleValue }}
                    </div>
                    <div><i class="bi bi-caret-down-fill down-icon"></i></div>
                </div>
            </button>
            <ul class="dropdown-menu role-menu" id="role">
                <li class="fontRoboto" (click)="$event.stopPropagation()">
                    <input type="checkbox" class="checkbox" [checked]="isAllSelected()" id="selectAll"
                        (change)="toggleSelectAll($event)" />
                    Select All
                </li>
                <li *ngFor="let role of roles; let i = index" class="fontRoboto" (click)="$event.stopPropagation()">
                    <input type="checkbox" class="checkbox" [checked]="isSelected(role)" id="{{i}}"
                        (change)="toggleRoleSelection(role, $event)" />
                    {{role.Text}}
                </li>
            </ul>
        </div>
        <div class="dropbox">
            <button type="button" class=" dropdown-btn custom-dropdown-button fontRoboto" data-bs-toggle="dropdown"
                aria-expanded="false" (click)="getcourselist()">
                <div class="d-flex">
                    <div class="ellipsis">
                        {{ courseValue }}
                    </div>
                    <div><i class="bi bi-caret-down-fill down-icon"></i></div>
                </div>
            </button>
            <ul class="dropdown-menu dept-menu">
                <li class="fontRoboto" style="position: sticky; top: 0px;">
                    <input type="text" class="form-control search-input" placeholder="Search..." (input)="filterCourses($event)">
                </li>
                <li class="fontRoboto">
                    <input type="checkbox" class="checkbox" [checked]="isAllCourseSelected()"
                        (change)="toggleSelectAllCourses($event)" /> Select All
                </li>
                <li class="fontRoboto" *ngFor="let cat of filteredCourseList; let i = index" (click)="$event.stopPropagation()">
                    <input type="checkbox" class="checkbox" [checked]="isCourceSelected(cat)" id="{{i}}"
                        (change)="toggleCategorySelection(cat, $event)" />
                    {{ cat.CATEGORYNAME }}
                </li>
            </ul>
        </div>
        <div class="dropbox">
            <button type="button" class=" dropdown-btn custom-dropdown-button fontRoboto" data-bs-toggle="dropdown"
                aria-expanded="false" (click)="getAssessmentlist()">
                <div class="d-flex">
                    <div class="ellipsis">
                        {{ assessmentValue }}
                    </div>
                    <div><i class="bi bi-caret-down-fill down-icon"></i></div>
                </div>
            </button>
            <ul class="dropdown-menu dept-menu">
                <li class="fontRoboto" style="position: sticky; top: 0px;">
                    <input type="text" class="form-control search-input" placeholder="Search..." (input)="filterAssessment($event)">
                </li>
                <li class="fontRoboto">
                    <input type="checkbox" class="checkbox" [checked]="isAllAssessmentsSelected()"
                        (change)="toggleSelectAllAssessments($event)" /> Select All
                </li>
                <li class="fontRoboto" *ngFor="let ass of filteredAssessmentList; let i = index"
                    (click)="$event.stopPropagation()">
                    <input type="checkbox" class="checkbox" [checked]="isAssessmentSelected(ass)" id="{{i}}"
                        (change)="toggleAssessmentSelection(ass, $event)" />
                    {{ ass.Assessment_title }}
                </li>
            </ul>
        </div>
    </div>
    <div class="dropdown-container-box  d-flex w-100 pt-2 justify-content-center gap-3">
        <mat-form-field class="example-full-width date-container">
            <mat-label>Start Date</mat-label>
            <input matInput [min]="minDate" [max]="maxDate" [matDatepicker]="startDatePicker"
                (dateChange)="onStartDateSelected($event)" readonly>
            <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #startDatePicker></mat-datepicker>
        </mat-form-field>
        <mat-form-field class="example-full-width date-container">
            <mat-label>End Date</mat-label>
            <input matInput [min]="minDate" [max]="maxDate" [matDatepicker]="endDatePicker"
                (dateChange)="onEndDateSelected($event)" readonly>
            <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #endDatePicker></mat-datepicker>
        </mat-form-field>

        <div class="buttons d-flex justify-content-start">
            <button class="btn w-100 fontRoboto" type="submit" (click)="getCourseReport()">SEARCH</button>

        </div>
        <div class="buttons d-flex justify-content-start">
            <button class="btn w-100 fontRoboto" type="reset" (click)="reset()">RESET</button>
        </div>
    </div>

    <div class="table-container px-2">
        <div class="search-container py-2 d-flex justify-content-between">
            <div class="fontRoboto login-label">
                Course Completion Report
            </div>
            <div class="d-flex gap-3">
                <div>
                    <input class="search" matInput (keyup)="applyFilter($event)" placeholder="Search" #input>
                </div>
                <button class="fontRoboto exportExcelButton" type="" (click)="exportToExcel()">Export to Excel</button>
            </div>
        </div>
        <div class="mat-elevation-z8 table-container">
            <table mat-table [dataSource]="dataSource" matSort>
                <ng-container matColumnDef="Userid">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header sticky="true"> UserID </th>
                    <td mat-cell *matCellDef="let element"> {{element.Userid}} </td>
                </ng-container>
                <ng-container matColumnDef="Name">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
                    <td mat-cell *matCellDef="let element"> {{element.Name}} </td>
                </ng-container>
                <ng-container matColumnDef="Gender">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Gender </th>
                    <td mat-cell *matCellDef="let element"> {{element.Gender}} </td>
                </ng-container>
                <ng-container matColumnDef="Region">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Region </th>
                    <td mat-cell *matCellDef="let element"> {{element.Region}} </td>
                </ng-container>
                <ng-container matColumnDef="Csst_Role">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> CsstRole </th>
                    <td mat-cell *matCellDef="let element"> {{element.Csst_Role}} </td>
                </ng-container>
                <ng-container matColumnDef="City">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> City </th>
                    <td mat-cell *matCellDef="let element"> {{element.City}} </td>
                </ng-container>
                <ng-container matColumnDef="Course">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Course </th>
                    <td mat-cell *matCellDef="let element"> {{element.Course}} </td>
                </ng-container>
                <ng-container matColumnDef="Read_Count">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Read_Count</th>
                    <td mat-cell *matCellDef="let element"> {{element.Read_Count}} </td>
                </ng-container>
                <ng-container matColumnDef="Attempt_Number">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Attempt_Number </th>
                    <td mat-cell *matCellDef="let element"> {{element.Attempt_Number}} </td>
                </ng-container>
                <ng-container matColumnDef="Adoption_Percent">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Adoption_Percent </th>
                    <td mat-cell *matCellDef="let element"> {{element.Adoption_Percent}} </td>
                </ng-container>
                <ng-container matColumnDef="Categoryname">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Categoryname </th>
                    <td mat-cell *matCellDef="let element"> {{element.Categoryname}} </td>
                </ng-container>
                <ng-container matColumnDef="Completion_Percent">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Completion_Percent </th>
                    <td mat-cell *matCellDef="let element"> {{element.Completion_Percent}}</td>
                </ng-container>
                <ng-container matColumnDef="Max_result_in_percentage">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Max_result_in_Percentage </th>
                    <td mat-cell *matCellDef="let element"> {{element.Max_result_in_percentage}} </td>
                </ng-container>
                <ng-container matColumnDef="Store_Code">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Store_Code</th>
                    <td mat-cell *matCellDef="let element"> {{element.Store_Code}} </td>
                </ng-container>
                <ng-container matColumnDef="Total_content_count">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Total_content_count</th>
                    <td mat-cell *matCellDef="let element"> {{element.Total_content_count}} </td>
                </ng-container>
                <ng-container matColumnDef="Start_date">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Start_date</th>
                    <td mat-cell *matCellDef="let element"> {{element.Start_date|date}} </td>
                </ng-container>
                <ng-container matColumnDef="Date_of_joining">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Date_of_Joining </th>
                    <td mat-cell *matCellDef="let element"> {{element.Date_of_joining|date}} </td>
                </ng-container>
                <ng-container matColumnDef="Status">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
                    <td mat-cell *matCellDef="let element"> {{element.Status}} </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
        </div>
        <mat-paginator [pageSizeOptions]="[5,10, 20]" showFirstLastButtons
            aria-label="Select page of periodic elements" class="paginator-sticky"></mat-paginator>
    </div>







    <ng-template #content let-modal>
        <div class="modal-content organizationSuccessModal" style="background: transparent">
            <div class="modal-body">
                <div>
                    <div style="position: relative">
                        <div class="row d-flex justify-content-center mt-3">
                            <div class="col-12 d-flex warning_message_upload justify-content-center font"
                                style="width: auto; position: relative; text-align: center">
                                <div class="mb-3 thumb">
                                    <div *ngIf="message == 'Loading data, please wait...';then loader else cross"></div>
                                    <ng-template #loader>
                                        <img src="assets/loader.gif" alt="" height="100" width="100">
                                    </ng-template>
                                    <ng-template #cross>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="#FF0000"
                                            class="bi bi-x-circle" viewBox="0 0 16 16">
                                            <path
                                                d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                                            <path
                                                d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708" />
                                        </svg>
                                    </ng-template>
                                </div>
                                {{message}}
                            </div>
                        </div>
                        <div class="col-12 d-flex justify-content-center">
                            <div type="button" *ngIf="message != 'Loading data, please wait...'"
                                class="custom-close-btn d-flex justify-content-center align-items-center submit_button mt-3 me-3 font d-flex justify-content-center fontInter"
                                data-bs-dismiss="modal" aria-label="Close" (click)="closeModal()">
                                Okay
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div *ngIf="message != 'Loading data, please wait...';then close "></div>
            <ng-template #close>
                <div class="close-button d-flex justify-content-center align-items-center" (click)="closeModal()">
                    X
                </div>
            </ng-template>

        </div>
    </ng-template>
</div>